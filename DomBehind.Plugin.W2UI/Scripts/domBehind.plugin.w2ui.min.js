var __extends,DomBehind;(function(n){var t;(function(t){var i=function(){function t(){}return t.SetValue=function(n,t){var r=n.attr("DateFormatted"),i;r||(n.attr("DateFormatted","true"),i=n.attr("DateFormat"),i||(i="yyyy/MM/dd"),n.w2field("date",{format:i}));n.val(t)},t.FormatProperty=n.Data.DependencyProperty.RegisterAttached("DateFormat",function(){},function(n,t){n.attr("DateFormat",t)},n.Data.UpdateSourceTrigger.Explicit,n.Data.BindingMode.OneWay),t.ValueProperty=n.Data.DependencyProperty.RegisterAttached("",function(n){return n.val()},function(n,i){t.SetValue(n,i)},n.Data.UpdateSourceTrigger.Explicit,n.Data.BindingMode.TwoWay),t.DateProperty=n.Data.DependencyProperty.RegisterAttached("",function(n){var t=n.val();return new Date(t)},function(n,i){var r;if(i instanceof Date){r=n.attr("DateFormat");r&&r==="yyyy/MM/dd"||n.w2field("date",{format:"yyyy/MM/dd"});var u=""+i.getFullYear(),f=new String(""+(i.getMonth()+1)).PadLeft(2,"0"),e=new String(""+i.getDate()).PadLeft(2,"0");n.val(u+"/"+f+"/"+e);r&&r!=="yyyy/MM/dd"&&n.w2field("date",{format:r})}else t.SetValue(n,i)},n.Data.UpdateSourceTrigger.Explicit,n.Data.BindingMode.TwoWay),t}();t.DatePicker=i})(t=n.Controls||(n.Controls={}))})(DomBehind||(DomBehind={})),function(n){var t;(function(t){var i=function(){function t(){this._engaged=!1}return t.Register=function(n){!n.Element},t.Rebuild=function(n,t){var i=t.ToArray(),r,u,f,e;return i.SequenceEqual(t.__oldArray)?!1:(t.__oldArray=i,$.each(i,function(n,t){t.recid=n}),r=i.Select(function(n){var i=n;return t.DisplayMemberPath&&(i=n[t.DisplayMemberPath]),{id:n.recid,text:i,obj:n}}),u={items:r,selected:{}},t.Current!=null&&(f=t.Current.recid,e=r.FirstOrDefault(function(n){return n.id===f}),u.selected=e),n.w2field("list",u),!0)},t.prototype.OnCurrentChanged=function(n,i){var u,r,o;if(!this._engaged)if(u=n.__element,r=u.Element,String.IsNullOrWhiteSpace(i.Name))t.Rebuild(r,n),r.data("w2field").refresh();else if(i.Name==="Current"){var f=r.data("w2field"),s=n.Current.recid,e=f.options.items;e instanceof Array&&(o=e.FirstOrDefault(function(n){return n.id===s}),r.data("selected",o),f.refresh())}},t.ItemsSourceProperty=n.Data.DependencyProperty.RegisterAttached("itemsSource",function(){},function(i,r){var u,f;if(r instanceof n.Data.ListCollectionView){if(!t.Rebuild(i,r))return;u=r.__element;u||(u=r.__element=new t);u.Element=i;u.Items=r;f=i.data("w2field");f.refresh();f.__Dropdown=u;i.off("change");i.on("change",function(){var t=i.data("selected").id,n;u._engaged=!0;try{n=r.ToArray().FirstOrDefault(function(n){return n.recid==t});u.Items.Select(n)}finally{u._engaged=!1}});r.PropertyChanged.RemoveHandler(u.OnCurrentChanged);r.PropertyChanged.AddHandler(u.OnCurrentChanged)}},n.Data.UpdateSourceTrigger.Explicit,n.Data.BindingMode.OneWay,function(n){t.Register(n)}),t}();t.Dropdown=i})(t=n.Controls||(n.Controls={}))}(DomBehind||(DomBehind={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t,i,f,r,u;(function(n){n[n.Text=1]="Text";n[n.Int=2]="Int";n[n.Double=3]="Double";n[n.Date=4]="Date";n[n.Hex=5]="Hex";n[n.Money=6]="Money";n[n.Currency=7]="Currency";n[n.Percent=8]="Percent";n[n.Alphanumeric=9]="Alphanumeric";n[n.Time=10]="Time";n[n.Color=11]="Color";n[n.List=12]="List"})(t=n.FieldType||(n.FieldType={})),function(n){n[n.Number=1]="Number";n[n.Currency=2]="Currency";n[n.Money=3]="Money";n[n.Percent=4]="Percent";n[n.Time=5]="Time";n[n.Date=6]="Date";n[n.Age=7]="Age";n[n.Toggle=8]="Toggle"}(i=n.RenderType||(n.RenderType={}));f=function(){function t(n){this.Owner=n}return Object.defineProperty(t.prototype,"items",{get:function(){if(!this.itemSource)return null;if(!this.__items){var t=new n.LamdaExpression(this.Owner,this.itemSource);this.__items=t.GetValue()}return this.__items},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.__type||(this.__type=r.FieldTypeToString(this.fieldType)),this.__type},enumerable:!0,configurable:!0}),t}();r=function(r){function u(){var n=r!==null&&r.apply(this,arguments)||this;return n.Column=[],n.__id=0,n}return __extends(u,r),Object.defineProperty(u.prototype,"IsMultiSelect",{get:function(){return this.GridOption&&this.GridOption.multiSelect?!0:!1},enumerable:!0,configurable:!0}),u.prototype.GenerateRecId=function(){return++this.__id},Object.defineProperty(u.prototype,"SelectedObject",{get:function(){var t=this.Grid.getSelection(),n;return!t||t.length===0?null:(n=[],$.each(this.Grid.records,function(i,r){t.Any(function(n){return n===r.recid})&&n.push(r)}),this.IsMultiSelect)?n:n.FirstOrDefault()},enumerable:!0,configurable:!0}),u.prototype.AddColumn=function(n){this.Column.push(n)},u.prototype.Ensure=function(){var t=this,r=this.Element.attr("id"),i,o,s,e;r||(r=NewUid(),this.Element.attr("id",r));$.each(this.Column,function(n,i){i.renderType&&(i.render=u.RenderTypeToString(i.renderType));i.editable&&(i.editable=$.extend(!0,new f(t.DataContext),i.editable))});i={name:r,columns:this.Column,show:{selectColumn:!1},multiSelect:!1,keyboard:!0};i.onDblClick=function(n){return t.OnDoubleClick(t.DataContext,n)};this.GridOption.footerOption&&(i.show.footer=!0);this.GridOption.headerOption&&(i.show.toolbar=!0,this.GridOption.headerOption.add&&(i.show.toolbarAdd=!0,i.onAdd=function(n){return t.OnToolbarAdd(t.DataContext,n)}),this.GridOption.headerOption.edit&&(i.show.toolbarEdit=!0,i.onEdit=function(n){return t.OnToolbarEdit(t.DataContext,n)}),this.GridOption.headerOption.save&&(i.show.toolbarSave=!0,i.onSave=function(n){return t.OnToolbarSave(t.DataContext,n)}),this.GridOption.headerOption.delete&&(i.show.toolbarDelete=!0,i.onDelete=function(n){return t.OnToolbarDelete(t.DataContext,n)}));this.GridOption.multiSelect&&(i.multiSelect=!0);this.GridOption.dragAndDropRow&&(i.reorderRows=!0);o=this.Column.Where(function(n){return!Object.IsNullOrUndefined(n.advancedSearch)});o.Any()&&(i.multiSearch=!0,i.searches=o.Select(function(n){return{field:n.field,caption:n.caption,type:u.FieldTypeToString(n.advancedSearch)}}));this.Grid=this.Element.w2grid(i);s=n.Data.DependencyProperty.RegisterAttached("itemsSource",function(){},function(i,r){var e,u,f;if(r instanceof n.Data.ListCollectionView&&(t.ListCollectionView=r,e=i.attr("id"),u=w2ui[e],u)){if(f=r.ToArray(),u.records===f)return;$.each(f,function(n,i){t.RowInjection(i)});u.clear(!0);u.records=f;u.total=f.length;u.refresh();u.onClick=function(n){t.OnSelect(t.DataContext,n);var i=$("#grid_"+e+"_focus");i.focus()};r.PropertyChanged.RemoveHandler(t.OnCurrentChanged);r.PropertyChanged.AddHandler(t.OnCurrentChanged)}});e=this.NewAdd(new n.Data.DataBindingBehavior);e.Property=s;e.PInfo=this.ItemsSource;e.Element=this.Element;u.Refresh.AddHandler(function(){try{t.Grid.refresh()}catch(e){}})},u.prototype.SuppressListCollectionViewAction=function(t){this.ListCollectionView.Begin();t(this.ListCollectionView);this.ListCollectionView.ViewReflected=n.Data.ListCollectionView.ViewReflectedStatus.Reflected;this.ListCollectionView.End()},u.prototype.OnSelect=function(n,t){if(this.GridOption.onSelect){var r=t.recid,i=this.Grid.get(r);this.SuppressListCollectionViewAction(function(n){return n.Current=i});this.GridOption.onSelect(n,i)}},u.prototype.OnDoubleClick=function(n,t){var u,i,f,r;if(this.GridOption&&this.GridOption.onDoubleClick&&(u=this.Element.attr("id"),i=w2ui[u],i)){f=t.recid;r=i.get(f);this.SuppressListCollectionViewAction(function(n){return n.Current=r});this.GridOption.onDoubleClick(n,r)}},u.prototype.OnToolbarAdd=function(n,t){if(this.GridOption&&this.GridOption.headerOption&&this.GridOption.headerOption.add){var i=this.GridOption.headerOption.add(n,t);i&&this.AddRow(i)}},u.prototype.AddRow=function(n){this.RowInjection(n);this.Grid.records.push(n);this.Grid.total=this.Grid.records.length;this.SuppressListCollectionViewAction(function(t){return t.Add(n)});this.Grid.refresh(n.recid);this.Grid.select(n.recid);this.Grid.scrollIntoView(n.recid)},u.prototype.OnToolbarEdit=function(n,t){if(this.GridOption&&this.GridOption.headerOption&&this.GridOption.headerOption.edit){var i=t.recid,r=this.Grid.get(i);this.GridOption.headerOption.edit(n,r)}},u.prototype.OnToolbarSave=function(n,t){if(this.GridOption&&this.GridOption.headerOption&&this.GridOption.headerOption.save){var i=t.recid,r=this.Grid.get(i);this.GridOption.headerOption.save(n,r)}},u.prototype.OnToolbarDelete=function(n,t){var i=this;this.GridOption&&this.GridOption.headerOption&&this.GridOption.headerOption.delete&&(t.force||(this._deleteTargets=this.SelectedObject),t.done&&t.done(function(){i.GridOption.headerOption.delete(n,i._deleteTargets)}))},u.prototype.OnCurrentChanged=function(n,t){String.IsNullOrWhiteSpace(t.Name)?this.Grid&&this.Grid.refresh():t.Name==="Current"},u.FieldTypeToString=function(n){var i="text";switch(n){case t.Text:i="text";break;case t.Int:i="int";break;case t.Double:i="float";break;case t.Date:i="date";break;case t.Hex:i="hex";break;case t.Money:i="money";break;case t.Currency:i="currency";break;case t.Percent:i="percent";break;case t.Alphanumeric:i="alphanumeric";break;case t.Time:i="time";break;case t.Color:i="color";break;case t.List:i="list"}return i},u.RenderTypeToString=function(n){var t="";switch(n){case i.Number:t="number";break;case i.Currency:t="currency";break;case i.Money:t="money";break;case i.Percent:t="percent";break;case i.Time:t="time";break;case i.Date:t="date";break;case i.Age:t="age";break;case i.Toggle:t="toggle"}return t},u.prototype.ParseCellStyles=function(n){var r=JSON.parse(n),u=[],i,t,f;for(i in r)for(t=0;t<this.Column.length;t++)if(f=this.Column[t],f.field===i){u[t]=r[i];break}return u},u.prototype.RowInjection=function(t){var u=this,r,i;t&&(t.w2ui||(t.w2ui={}),t.recid=this.GenerateRecId(),this.RowStyleBinding&&(r=this.RowStyleBinding(t),String.IsNullOrWhiteSpace(r)||(t.w2ui.style=r),t.__rowStyleObserver||(i=n.Observable.Register(t,n.LamdaExpression.Path(this.RowStyleBinding)),i.PropertyChanged.Clear(),i.PropertyChanged.AddHandler(function(n){var i=n.recid,r=u.RowStyleBinding(n);t.w2ui.style=r;u.Grid.refreshRow(i)}),t.__rowStyleObserver=i)),this.CellStyleBinding&&(r=this.CellStyleBinding(t),String.IsNullOrWhiteSpace(r)||(t.w2ui.style=this.ParseCellStyles(r)),i=n.Observable.Register(t,n.LamdaExpression.Path(this.CellStyleBinding)),i.PropertyChanged.Clear(),i.PropertyChanged.AddHandler(function(n){var i=n.recid,r=u.CellStyleBinding(n);t.w2ui.style=u.ParseCellStyles(r);u.Grid.refreshRow(i)})),this.RowClassBinding&&(r=this.RowClassBinding(t),String.IsNullOrWhiteSpace(r)||(t.w2ui.class=r),i=n.Observable.Register(t,n.LamdaExpression.Path(this.RowClassBinding)),i.PropertyChanged.Clear(),i.PropertyChanged.AddHandler(function(n){var i=n.recid,r=u.RowClassBinding(n);t.w2ui.class=r;u.Grid.refreshRow(i)})),$.each(this.Column,function(i,r){if(r.convertTarget)var u=n.Observable.RegisterAttached(t,{marks:[r.field],wrapper:function(n){return r.convertTarget(n)}})}))},u.Refresh=new n.TypedEvent,u.IsSpinningProperty=n.Data.DependencyProperty.RegisterAttached("w2ui.isSpinning",function(){},function(n,t){var r=n.attr("w2ui.isSpinning"),u,i;r==="true"&&t||(r!=="false"||t)&&(n.attr("w2ui.isSpinning",String(t)),u=n.attr("id"),i=w2ui[u],i&&(t?i.lock("",!0):i.unlock()))},n.Data.UpdateSourceTrigger.Explicit,n.Data.BindingMode.OneWay),u}(n.Data.BindingBehavior);n.W2GridBindingBehavior=r;u=function(t){function i(n){return t.call(this,n)||this}return __extends(i,t),Object.defineProperty(i.prototype,"DefaultOption",{get:function(){return{caption:"",field:"",size:null,min:"15",max:null,hidden:!1,hideable:!0,sortable:!0,searchable:!1,resizable:!0,attr:"",style:"",render:null,title:null,editable:null,frozen:!1,info:null}},enumerable:!0,configurable:!0}),i.prototype.ColumnBinding=function(t,i,r){var u=$.extend(!0,this.DefaultOption,r),f;return u.caption=t,u.field=n.LamdaExpression.Path(i),f=this.CurrentBehavior,f.AddColumn(u),this},i.prototype.RowStyleBinding=function(n){var t=this.CurrentBehavior;return t.RowStyleBinding=n,this},i.prototype.RowCssBinding=function(n){var t=this.CurrentBehavior;return t.RowClassBinding=n,this},i.prototype.CellStyleBinding=function(n){var t=this.CurrentBehavior;return t.CellStyleBinding=n,this},i}(n.BindingBehaviorBuilder);n.W2GridBindingBehaviorBuilder=u;n.BindingBehaviorBuilder.prototype.BuildGrid=function(t,i){var f,e,s,o;return i=$.extend(!0,{},i),f=this,e=f.Add(new r),e.NewAdd=function(n){return f.Add(n)},e.ItemsSource=new n.LamdaExpression(f.Owner.DataContext,t),e.GridOption=i,i.isSpinning&&(s=f.Add(new n.Data.DataBindingBehavior),s.Property=r.IsSpinningProperty,s.PInfo=new n.LamdaExpression(f.Owner.DataContext,i.isSpinning)),f.CurrentBehavior=e,o=new u(f.Owner),o.CurrentElement=f.CurrentElement,o.CurrentBehavior=f.CurrentBehavior,o}}(DomBehind||(DomBehind={}));
//# sourceMappingURL=domBehind.plugin.w2ui.min.js.map